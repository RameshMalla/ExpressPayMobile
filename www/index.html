<!DOCTYPE html>
<html>

  <head>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-route.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-animate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.2/chosen.jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.2/chosen.proto.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.2/chosen.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Sonsie+One" rel="stylesheet">
    <title>DigiPay</title>
    <style>
      .scannedResult {
        height: 500px;
        background: url("img/barcode.png") no-repeat;
        background-size: contain;
        background-position: 12px;
      }

      .branddiv {
        padding: 10px;
        /*border-bottom: 1px solid white;*/
        background-color: rgb(92, 184, 92);
        color: white;
        /*font-family: 'Lobster', cursive;*/
        font-family: 'Sonsie One', cursive;
      }

      .menuheader {
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 3;
        background-color: black;
      }

      .menudiv {
        display: block;
      }

      .menudiv .col-xs-3 {
        border-right: 2px solid #201e23;
        background-color: #363538;
        padding-top: 12px;
        text-align: center;
        padding-bottom: 6px;
        font-size: 19px;
        color: white;
        cursor: pointer;
        height: 63px;
      }

      .menudiv .col-xs-3 a {
        color: white;
      }
      .menudiv .col-xs-3 a:active {
        color: black;
      }

      .barcodeglyph {
        font-size: 230px;
        top: 81px;
        color: rgba(0, 0, 0, 0.17);
      }

      .qrcodeglyph {
        color: rgba(0, 0, 0, 0.17);
      }

      .scancontent {
        text-align: center;
        /*border-top: 2px solid black;*/
      }

      .scanbutton {
        /*background-color: #ef5e53;
            border-color: #ef5e53;*/
      }

      .scandiv {
        text-align: center;
        position: relative;
        top: 100px;
      }

      .qrdiv {
        text-align: center;
        position: relative;
      }

      .subcontent {
        top: 116px;
        position: relative;
        /*border-top: 3px solid black;*/
      }

      .customactive {
        background-color: #201e23 !important;
        color: #428039 !important;
        border-bottom: 2px solid #5cb85c !important;
      }

      .customactiveside {
        background-color: #201e23 !important;
        color: #428039 !important;
      }

      .customactiveside> a {
        background-color: #201e23 !important;
        color: #428039 !important;
      }

      .toolbuttons {
        float: right;
        position: relative;
        color: #fff;
        background-color: #363538;
        border-color: #201e23;
      }

      .trashcan {
        top: 18px;
      }

      .descpara {
        font-size: 13px;
        font-weight: 900;
      }

      .cartgroup {
        background-color: #eaeaea;
        border: 0;
        /*border-top: 6px solid #201e23;*/
        border-bottom: 1px solid #e0e0e0;
        /*-webkit-box-shadow: 0 10px 26px -9px rgba(0, 0, 0, 0.75);
            -moz-box-shadow: 0 10px 26px -9px rgba(0, 0, 0, 0.75);
            box-shadow: 0 10px 26px -9px rgba(0, 0, 0, 0.75);*/
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 2%;
        padding-left: 0;
        padding-right: 0;
      }
      .cartgroup:first-child,
      .cartgroup:last-child {
        border-radius: 1px;
      }
      .cartgroup:first-child {
        margin-top: 0;
      }

      .overlaycontent {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 4;
        /*background-color: #363538;*/
        /*background-color: #5cb85c;*/
        background-color: rgb(29, 29, 29);
      }

      .paybutton {
        float: right;
        width: 90px;
        font-weight: 900;
        color: white;
        background-color: #363538;
        border-color: #201e23;
      }
      .paybutton:hover {
        color: white;
        background-color: #363538;
        border-color: #201e23;
      }

      .customcontainer {
        padding-right: 0;
        padding-left: 0;
      }

      .divider {
        height: 1px;
        width: 123px;
        background-color: #929292;
        position: relative;
        top: 9px;
      }

      .cartpanel {
        margin-bottom: 0;
        border: none;
      }

      .cartbody {
        padding-right: 0;
        padding-left: 0;
      }

      .cartdesc {
        padding-left: 0;
        line-height: 19px;
        font-size: 13px;
      }

      .custompanelfooter {
        padding: 0;
      }

      .toolcolumn {
        padding: 12px;
        text-align: center;
        cursor: pointer;
        border-bottom: 2px solid #c7c7c7;
      }

      .paymentfooter {
        position: fixed;
        top: 92%;
        width: 100%;
        text-align: center;
        height: 8%;
      }

      .custommodelcontent {
        overflow: hidden;
        border: none;
        border-radius: 13px;
      }

      .custommodalheader {
        background-color: #ca3d3a;
        color: white;
      }

      .edmodal {
        overflow: visible;
      }

      .edmodal-body {
        overflow-y: visible !important;
      }

      .paymentcontainer {
        /*display: none;*/
        padding: 0;
        border-bottom: 1px solid #c6c6c6;
      }

      .customtabs> li> a {
        font-weight: 900;
        background-color: #5cb85c;
        color: white;
      }

      .paymenu {
        padding: 0;
      }

      .payment-group-item {
        padding: 23px 15px;
        text-align: center;
        border: 1px solid #FFF;
        background-color: #363538;
        cursor: pointer;
        color: white !important;
      }
      .payment-group-item:hover {
        color: #363538 !important;
      }

      .activepaymentgroup {
        background-color: white;
        color: #363538 !important;
        border-left: 3px solid #565956;
      }
      /*a.payment-group-item {
            color: white;
        }*/
      .payment-group-item:first-child {
        border-radius: 0;
        border-top: 0 solid white;
      }
      .payment-group-item:last-child {
        border-radius: 0;
        border-bottom: 0 solid white;
      }

      .custom-form-control {
        display: inline;
      }

      .custom-form-control {
        width: 80px;
      }

      .input-group .custom-form-control {
        width: 80px;
      }

      .custom-addon {
        padding: 6px 7px;
      }

      .headerrow {
        margin: 0;
        color: #7d7d7d;
        padding: 10px 3px;
        background-color: #efefef;
        border-bottom: 1px solid #b3b3b3;
      }

      .bankcol {
        padding: 5px;
      }

      .bankcol img {
        cursor: pointer;
      }

      .ordersummarycol {
        padding-top: 16px;
        padding-left: 5px;
        padding-right: 5px;
        /*border-top: 3px solid #5cb85c;*/
      }

      .activeBank {
        background-color: #363538;
      }

      .offercarousel div {
        /*background-color: #363538;*/
      }

      .offercarousel div img {
        /*width: 100%;*/
        width: 100%;
        height: 175px;
      }

      .offerrow img {
        width: 100%;
        height: 175px;
        padding: 14px;
      }

      .offernewfooter {
        position: fixed;
        bottom: 0;
        width: 100%;
        background-color: #363538;
        text-align: center;
        color: white;
        height: 40px;
        left: 0;
        z-index: 1;
      }
      .offernewfooter div:first-child {
        /*border-right: 1px solid black;*/
      }

      .offernewfooter div {
        height: 100%;
        padding: 8px;
        font-weight: 900;
        border-right: 1px solid #201e23;
      }

      .offerviewcontainer {
        overflow-y: auto;
      }

      .offersactive {
        background-color: #201e23;
        color: #5cb85c;
        border-top: 3px solid;
      }

      .offerfluid {
        padding-left: 0;
        padding-right: 0;
      }

      .offer-group-item {
        /*border: 7px solid #c1b9b9;
        border-bottom: 6px solid #dadad8;*/
        padding: 4px 0 7px 3px;
      }

      .offertools {
        position: fixed;
        width: 100%;
        background-color: #363538;
        color: white;
        z-index: 3;
        height: 40px;
        /*padding: 10px;*/
      }

      .sortradio {
        margin-top: 0;
        margin-bottom: 5px;
      }

      .sortradio label {
        width: 100%;
        padding-top: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid #bfbfbf;
        padding-left: 37px;
      }

      .quantbtn {
        border-radius: 0;
        padding: 0 4px;
      }

      .offer-list-group {
        font-size: 10px;
        text-align: center;
      }

      .custom-thumbnail {
        -webkit-box-shadow: 2px 2px 19px -1px rgb(158, 156, 161);
        -moz-box-shadow: 2px 2px 19px -1px rgb(158, 156, 161);
        box-shadow: 2px 2px 19px -1px rgb(158, 156, 161);
        border-radius: 0;
      }

      .appheading {
        text-align: center;
        color: white;
        font-size: 74px;
        font-family: cursive;
      }

      .coverpic {
        position: absolute;
        z-index: -1;
        width: 100%;
        height: 100%;
        top: 0;
        opacity: 0.07;
      }

      .logo {
        position: relative;
        opacity: 0.0;
        top: 200px;
      }

      .openinputgroup {
        width: 100%;
      }

      .phoneinput {
        border-radius: 13px !important;
        padding: 20px;
      }

      .formspan,
      .myforminput {
        border-top: 0;
        border-left: 0;
        border-right: 0;
        border-radius: 0 !important;
        border-top: 2px solid #0b9444;
        border-bottom: 0 solid #0b9444;
        background-color: rgba(0, 0, 0, 0.12);
        color: white;
      }

      .myinputgroup {
        /*padding-top: 10px;*/
        margin-top: 3%;
        left: 110%;
      }
      .myforminput:focus {
        border-color: transparent;
        outline: 0;
        box-shadow: none;
        -webkit-box-shadow: none;
        border-top: 2px solid #0b9444;
      }

      .overlaycontent {
        animation-duration: 0.5s;
      }

      .videocontainer {
        width: 100%;
        height: 100%;
        position: absolute;
        padding: 0;
        margin: 0;
        left: 0;
        top: 0;
        z-index: -1000;
        overflow: hidden;
      }

      #myvideo {
        min-height: 100%;
        min-width: 100%;
        position: absolute;
        bottom: 0;
        left: 0;
      }

      .discovercontainer {
        position: relative;
      }

      .backdrop {
        position: fixed;
        background-color: rgba(0, 0, 0, 0.25);
        height: 100%;
        width: 100%;
        display: none;
        opacity: 0;
        transition: all 0.3s;
        z-index: 2;
      }

      .backdropover {
        display: block;
        opacity: 1;
      }

      .discoversidemenu {
        position: fixed;
        height: 17%;
        width: 70%;
        top: 34%;
        left: -59%;
        transition: all 0.3s;
        z-index: 3;
      }
      /*.sidebtnlist:first-child {
        border-top-left-radius: 0;
        border-top-right-radius: 15px;
        border-top: 0;
      }
      .sidebtnlist:last-child {
        border-bottom-right-radius: 15px;
        border-bottom-left-radius: 0;
        border-bottom: 0;

      }*/

      .sidebtnlist {
        font-weight: 900;
        border-right: 0;
      }
      .sidebtnlist:focus {
        outline: none;
      }
      .sidedrag:focus {
        outline: none;
      }

      .discovermaincontent {
        position: relative;
        top: 40px;
      }

      .sidedrag {
        position: relative;
        top: 22px;
        border-radius: 0;
        border-top-right-radius: 6px;
        border-bottom-right-radius: 6px;
        width: 25px;
        left: -5px;
        background-color: #363538;
        color: white;
        height: 81px;
      }
      .sidedrag:hover {
        background-color: #363538;
        color: white;
      }

      .move {
        left: 0;
      }

      .transaction-group {
        padding: 1%;
      }

      .trans-date-col {
        padding: 0;
        border-right: 2px solid #c3c3c3;
        text-align: center;
      }

      .trans-details-col {
        font-size: 10px;
        padding-left: 5%;
        padding-top: 3%;
        padding-right: 0;
      }

      .qpaymodel {
        border: none;
      }

      .qpaymodel> .panel-heading {
        border: none;
        border-radius: 0;
        color: #fff;
        background-color: #363538;
      }

      .qpaymodel .list-group-item {
        padding: 10px 10px 10px 23px;
        font-size: 11px;
        font-weight: 700;
        background-color: beige;
      }

      .qpbtn {
        float: right;
        position: relative;
        top: -2px;
        padding: 1px 18px;
      }

      .discovermainheading {
        height: 42px;
        width: 100%;
        background-color: #363538;
        position: fixed;
        z-index: 2;
        border-top: 3px solid black;
      }

      .customdrop {
        /*display: inline;*/
        float: right;
        margin-top: 5px;
        margin-right: 10px;
      }

      .customdrop> button {
        float: right;
        padding: 3px 10px;
      }

      .customdrop .dropdown-backdrop {
        background-color: rgba(54, 53, 56, 0.33);
      }

      .customdrop hr {
        margin-top: 0;
        margin-bottom: 0;
      }

      .sidebtnlist a {
        padding: 7px 23px !important;
        font-weight: 900 !important;
      }

      .qpayedit {
        padding: 3px 4px;
        font-weight: 900;
        float: right;
      }

      .qpaycardpanel {
        padding: 4px;
        font-size: 11px;
      }

      .qpaybankpanel {
        padding: 17px;
        font-size: 11px;
      }

      .qpaycardpanel,
      .qpaybankpanel {
        display: none;
      }
      .rvbtn {}
      .sidemenuoverlay {
        position: fixed;
        height: 100%;
        width: 100%;
        background-color: white;
        z-index: 5;
        right: 100%;
        -webkit-transition: right 0.2s;
        transition: right 0.2s;
      }

      .sidemenumove {
        right: 0;
      }
      .settingsheader {
        background-color: #5cb85c;
        color: white;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      .settingback {
        font-size: 20px;
        padding-right: 8px;
      }
      .settingspan {
        padding-left: 18px;
        font-size: 20px;
        font-weight: 900;
      }
      .settingsgroup {
        border-left: 0;
        border-right: 0;
      }
      .settingsgroup:first-child {
        border-radius: 0;
      }
      .settingsgroup:last-child {
        border-radius: 0;
      }
      .customchecklabel {
        height: 18px;
        width: 18px;
        border: 3px solid;
        position: absolute;
        right: 15px;
        overflow: hidden;
      }
      .customchecklabel::before {
        content: '';
        height: 15px;
        width: 15px;
        background-color: white;
        position: absolute;
        z-index: 1;
        -webkit-transition: all 0.1s;
        transition: all 0.1s;
      }
      .customchecklabel::after {
        content: '';
        position: absolute;
        border: 0 solid black;
        left: 4px;
        top: 0;
        height: 10px;
        width: 6px;
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
        -webkit-transition: all 0.2s;
        transition: all 0.2s;
      }
      [type=checkbox].myfillin:checked+label:after {
        border: 2px solid black;
        -webkit-transform: rotate(48deg);
        transform: rotate(48deg);
        border-left: 0;
        border-top: 0;
      }
      [type=checkbox].myfillin:checked+label:before {
        background: #5cb85c;
        z-index: 0;
      }
      .myfillin {
        position: relative;
        left: -999px;
      }

      .registercontainer {
        left: 172%;
      }

      .shareoverlay {
        position: fixed;
        background-color: white;
        width: 100%;
        height: 100%;
        bottom: 0;
        z-index: 4;
        display: none;
        right: 100%;
      }
      .shopscancontainer {
        position: absolute;
        width: 213px;
        right: 0;
        left: 100%;
        margin: auto;
        bottom: 50%;
      }

      .contactsfooter {
        position: fixed;
        bottom: 0;
        background-color: #5cb85c;
        padding-top: 11px;
        z-index: 2;
      }
      .contacatscolumn {
        padding: 0;
        /* height: 0px; */
        height: 83%;
        overflow-y: auto;
      }
      .subinfo {
        padding: 3px 22px;
        color: gray;
        font-weight: 700;
      }

    </style>
    <script type="text/javascript">
      $(document).ready(function() {
        //console.log(typeof localStorage.phoneNumber == 'undefined');
        localStorage.phoneNumber = null;
        console.log(localStorage.phoneNumber);
        if (localStorage.phoneNumber == "null") {
          $('.overlaycontent').css('display', 'block');
        }

        // var socket = io.connect('http://192.168.0.102:4000');
        // socket.on('testing', function(msg) {
        //   console.log(msg);
        // });

        if (localStorage.notifications == null) {
          localStorage.notifications = [];
        }

        document.addEventListener("deviceready", function() {
          console.log("Readyyy");
          cordova.plugins.backgroundMode.enable();
          cordova.plugins.backgroundMode.onactivate = function() {
            cordova.plugins.notification.local.schedule({id: 2, title: "Local Notification Example", text: "Multi Notification 2"});
          }

        }, false);

        function triggerAnimate() {
          $('.logo').animate({
            top: '0px',
            opacity: '1'
          }, "2000", "easeOutBack", function() {
            $('.phgroup').animate({
              left: "0%"
            }, "2000", "easeOutBack", function() {
              $('.scangroup').animate({
                left: "0%"
              }, "2000", "easeOutBack");
            });
          });
        }

        $('.registerbtn').click(function() {
          //function callInRegister() {
          $('.logincontainer').animate({
            right: '110%'
          }, "1000", "easeOutBack", function() {
            $('.registercontainer').animate({
              left: '0%'
            }, "1000", "easeOutBack");
          })
          //}
        });

        $('.backbutton').click(function() {
          $('.registercontainer').animate({
            left: '172%'
          }, "1000", "easeOutBack", function() {
            $('.logincontainer').animate({
              right: '0%'
            }, "1000", "easeOutBack");
          })

        });

        setTimeout(function() {
          triggerAnimate()
        }, 2000);

        //$('.car').slick({arrows:false,mobileFirst:true});
        $(".paybutton").prop('disabled', true);
        $('.paybutton').css("display", "none");
        $(".scanlink").children(".col-xs-3").addClass("customactive");
        // $(".scanlink").addClass("customa");
        $(".menudiv a").click(function() {
          $(".menudiv a").each(function(index) {
            if ($(this).children(".col-xs-3").hasClass("customactive")) {
              $(this).children(".col-xs-3").removeClass("customactive")
              return false;
            }
          });
          $(this).children(".col-xs-3").addClass("customactive");
        });

        $('.settings').click(function() {
          $('.sidemenuoverlay').toggleClass('sidemenumove');
        })

      });
    </script>
  </head>

  <body ng-app="expresspayapp">
    <div class="" ng-controller="mainController">
      <div class="overlaycontent" style="display:none;">
        <div class="menu-divider">
          <img src="img/cover.jpg" class="coverpic" alt=""/>
          <div class="logo container" style="text-align:center;">
            <img src="img\digipay.png" alt="DigiPay" style="width:200px;"/>
          </div>
          <div class="container shopscancontainer">
            <button type="button" class="btn btn-large btn-success" ng-click="scanShopQrCode()" name="button">
              <i class="fa fa-qrcode" aria-hidden="true"></i>&nbsp;&nbsp;Scan Shop QR-CODE</button>
          </div>
          <div class="container logincontainer" style="width:100%;position:absolute;bottom: 43%;">
            <div class="input-group input-group-lg myinputgroup phgroup">
              <span class="input-group-addon formspan" id="sizing-addon1">
                <span class="glyphicon glyphicon-phone" style="color:#5cb85c;"></span>
              </span>
              <input type="number" ng-model="userphonenumber" class="form-control myforminput" placeholder="Phone Number" aria-describedby="sizing-addon1">
              <span class="input-group-addon formspan indicator" id="sizing-addon1"></span>
            </div>
            <div class="phgroup"></div>
            <div class="input-group input-group-lg myinputgroup scangroup" style="width:100%;">
              <button type="button" class="btn btn-success btn-md" ng-click="checkUserExist(userphonenumber)">
                <span class="fa fa-shopping-cart" style="color:white;"></span>&nbsp;&nbsp;&nbsp;Shop-IN</button>
              <button type="button" style="float:right;" class="animated btn btn-success btn-md registerbtn">
                <span class="fa fa-sign-in" style="color:white;"></span>&nbsp;&nbsp;&nbsp;New User</button>
            </div>
          </div>
          <div class="container registercontainer" style="width:100%;position: absolute;bottom: 43%;">
            <div class="errordiv" style="color:#e73d3d;text-align:center;"></div>
            <div class="input-group input-group-lg phgroup">
              <span class="input-group-addon formspan" id="sizing-addon1">
                <span class="glyphicon glyphicon-phone" style="color:#5cb85c;"></span>
              </span>
              <input type="number" ng-model="userphonenumber" class="form-control myforminput" placeholder="Phone Number" aria-describedby="sizing-addon1">
            </div>
            <div class="input-group input-group-lg emailgroup" style="margin-top: 3%;">
              <span class="input-group-addon formspan" id="sizing-addon1">
                <span class="fa fa-envelope" style="color:#5cb85c;"></span>
              </span>
              <input type="text" ng-model="useremail" class="form-control myforminput" placeholder="Email" aria-describedby="sizing-addon1">
            </div>
            <!-- <div class="phgroup"></div> -->
            <div class="input-group input-group-lg myinputgroup scangroup" style="width:100%;">
              <button type="button" class="btn btn-success btn-md backbutton">
                <span class="fa fa-reply" style="color:white;"></span>&nbsp;&nbsp;&nbsp;Cancel</button>
              <button type="button" style="float:right;" class="btn btn-success btn-md newuserbtn" ng-click="addNewUser(userphonenumber,useremail)">
                <span class="fa fa-sign-in" style="color:white;"></span>&nbsp;&nbsp;&nbsp;Sign-Up</button>
              <!-- <button type="button" class="btn btn-success btn-lg btn-block" ng-click="scanShopQrCode()">
              <span class="glyphicon glyphicon-qrcode" style="color:white;"></span>&nbsp;&nbsp;&nbsp;Scan Store QR Code</button> -->
            </div>
          </div>
        </div>
      </div>
      <div class="sidemenuoverlay">
        <div class="col-xs-12 settingsheader">
          <i class="fa fa-chevron-left settingback settings" ng-click="updateSettings()" aria-hidden="true"></i>
          <span class="settingspan">Settings</span>
        </div>
        <div class="col-xs-12" style="padding:0px;">
          <ul class="list-group">
            <li class="list-group-item settingsgroup">
              <i class="fa fa-users" aria-hidden="true"></i>&nbsp;&nbsp;
              <strong>Share your purchase Info</strong>
              <input ng-model="isSharable" type="checkbox" class="myfillin" id="share">
              <label class="customchecklabel" for="share"></label>
            </li>
            <li class="list-group-item settingsgroup">
              <i class="fa fa-envelope" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
              <strong>Email ID</strong>
              <div class="subinfo">
                <span>{{emailId}}</span>
              </div>
            </li>
            <li class="list-group-item settingsgroup">
              <i class="fa fa-tag" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
              <strong>Store Info</strong>
              <div class="subinfo">
                <span>{{storeFullAddress}}</span>
              </div>
            </li>
            <!-- <li class="list-group-item settingsgroup">Morbi leo risus</li>
          <li class="list-group-item settingsgroup">Porta ac consectetur ac</li>
          <li class="list-group-item settingsgroup">Vestibulum at eros</li> -->
          </ul>
        </div>
      </div>
      <div class="maincontent">
        <header class="menuheader">
          <div class="col-xs-12 branddiv">
            <div class="col-xs-2 settings" style="text-align:center;">
              <span class="fa fa-cog" style="font-size: 28px;position: fixed;left: 16px;color: white;top: 13px;" aria-hidden="true"></span>
            </div>
            <div class="col-xs-8" style="text-align:center;">
              <strong style="font-size: x-large;">Digi Pay</strong>
            </div>
            <!-- <div class="col-xs-2 notification" style="text-align:center;">
            <span class="fa fa-bell" data-toggle="modal" data-target=".bs-example-modal-sm" style="font-size: 28px;position: fixed;color: white;top: 13px;right:13px;" aria-hidden="true"></span>
          </div> -->
          </div>
          <div class="menudiv">
            <a href="#/scan" class="scanlink">
              <div class="col-xs-3">
                <!-- <a href="#/scan" class="scanlink"> -->
                <span class="glyphicon glyphicon-tags" aria-hidden="true"></span>
                <p class="descpara">
                  Shop
                </p>
              </div>
            </a>
            <a href="#/cart" class="cartLink" id="triggers">
              <div class="col-xs-3 cartmenu" style="position:relative;">
                <span class="glyphicon glyphicon-shopping-cart animated infinite pulse" aria-hidden="true"></span>
                <span class="badge cartnum" style="position:absolute;background-color:#5cb85c;"></span>
                <p class="descpara">
                  Cart
                </p>
              </div>
            </a>
            <a href="#/offers" class="offerLink">
              <div class="col-xs-3">
                <span class="glyphicon glyphicon-sunglasses" aria-hidden="true"></span>
                <p class="descpara">
                  Offers
                </p>
              </div>
            </a>
            <a href="#/discover" class="discoverlink">
              <div class="col-xs-3" style="border-right:none">
                <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                <p class="descpara">
                  Discover
                </p>
              </div>
            </a>
          </div>
        </header>
        <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
          <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" style="overflow:hidden;">
              <div class="modal-header" style="background-color:#5cb85c;color:white;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="gridSystemModalLabel">Notifications</h4>
              </div>
              <div class="modal-body" style="padding:0px;">
                <div class="list-group">
                  <a href="#" class="list-group-item" ng-repeat="notify in notificationList">{{notificationList}}</a>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        <div class="subcontent" ng-view></div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ng-cordova/0.1.27-alpha/ng-cordova.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ng-cordova/0.1.27-alpha/ng-cordova-mocks.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
      var expressPayModule = angular.module("expresspayapp", ["ngRoute", "ngCordova"]);
      expressPayModule.config([
        '$routeProvider',
        function($routeProvider) {
          $routeProvider.when('/scan', {
            templateUrl: 'view/scanview.html',
            controller: 'scanController'
          }).when('/cart', {
            templateUrl: 'view/cartview.html',
            controller: 'cartController'
          }).when('/offers', {
            templateUrl: 'view/offerview.html',
            controller: 'offerController'
          }).when('/discover', {
            templateUrl: 'view/discover.html',
            controller: 'discoverController'
          }).otherwise({redirectTo: '/scan'});
        }
      ]);

      expressPayModule.controller("mainController", function($scope, inventoryService, userservice, storeservice, $timeout, $window) {
        $scope.tests = 'D';
        $scope.isSharable = true;

        var socket = io.connect('http://192.168.0.102:4000');
        socket.on('testing', function(msg) {
          console.log(msg);
        });

        $scope.updateSettings = function() {
          userservice.updateIsSharrable(localStorage.phoneNumber, $scope.isSharable, function(response) {
            console.log("Upated");
          })
        }

        //$scope.notificationList = [];
        //console.log(typeof JSON.parse(localStorage.notifications));
        socket.on('offernotification', function(message) {
          //console.log("From Server");
          //console.log(message);
          var contactList = userservice.getUserContacts();
          //if (message.from != "9940366400") {
          for (var variable in contactList) {
            if (contactList[variable].phoneNumber == message.from) {
              console.log(contactList[variable].displayName);
              var name = contactList[variable].displayName;
              var notifymessage = name + " shared about " + message.message + " at " + localStorage.storeName;
              console.log(notifymessage);
            }
          }
          //}
        })

        //localStorage.removeItem("phoneNumber");
        // $scope.testPlugin = function() {
        //   window.plugins.sim.getSimInfo(function(result) {
        //     console.log(JSON.stringify(result));
        //     alert(JSON.stringify(result));
        //   }, function(error) {
        //     console.log(error);
        //     alert(error);
        //   });
        // }
        //REMOVE IT WHILE ADDING OVERLAY
        $scope.checkUserExist = function(userPhoneNumber) {
          $('.indicator').html('').append('<span class="fa fa-cog fa-spin" style="color:#5cb85c;"></span>');
          //        var contactsList = [];

          var contactsList = [
            {
              "displayName": "Ramesh Malla",
              "phoneNumber": "9940366400"
            }, {
              "displayName": "Malla",
              "phoneNumber": "9940366401"
            }, {
              "displayName": "Doe",
              "phoneNumber": "9940366402"
            }
          ];
          userservice.setUserContacts(contactsList);

          //userservice.setUserContacts(contactsList);
          // navigator.contacts.find([navigator.contacts.fieldType.displayName], function(c) {
          //   console.log("gotContacts, number of results " + c.length);
          //   for (var i = 0, len = c.length; i < len; i++) {
          //     if (c[i].displayName != null && c[i].phoneNumbers != null) {
          //       var phoneNumberVal = String(c[i].phoneNumbers[0].value);
          //       // if (phoneNumberVal.length > 10 && phoneNumberVal) {}
          //       var contactObject = {
          //         "displayName": c[i].displayName,
          //         "phoneNumber": c[i].phoneNumbers[0].value
          //       }
          //       contactsList.push(contactObject);
          //       console.log(c[i].displayName + " : " + c[i].phoneNumbers[0].value);
          //     }
          //     //console.log(c[i]);
          //   }
          //
          //   console.log(contactsList);
          //   userservice.setUserContacts(contactsList);
          // }, function(e) {
          //   console.log("errorHandler: " + e);
          // });
          userservice.checkUserInfo(userPhoneNumber, function(responsedata) {
            console.log(responsedata);
            if (responsedata != null) {
              $('.indicator').html('').append('<span class="fa fa-thumbs-up" style="color:#5cb85c;"></span>');
              setTimeout(function() {
                $('.logincontainer').animate({
                  right: "110%"
                }, "fast", "easeOutBack", function() {
                  $('.shopscancontainer').animate({
                    left: "0%"
                  }, "fast", "easeOutBack");
                });
              }, 200);
              localStorage.phoneNumber = userPhoneNumber;
              $scope.emailId = responsedata.emailId;
              //$scope.$apply(function() {
              $scope.isSharable = responsedata.isSharable;
              localStorage.offerId = responsedata.offerId;
              //})
              // $('.overlaycontent').addClass('animated fadeOutLeft');
              // setTimeout(function() {
              //   $('.overlaycontent').css('display', 'none');
              // }, 1000);
            } else {
              $('.registerbtn').removeClass('wobble');
              $('.indicator').html('').append('<span class="fa fa-thumbs-down" style="color:#e84747;"></span>');
              setTimeout(function() {
                $('.registerbtn').addClass('wobble');
              }, 1000);
            }
          });

        }

        $scope.addNewUser = function(phoneNumber, emailId) {
          var requestObject = {
            "phoneNumber": phoneNumber,
            "emailId": emailId,
            "jointAccounts": [],
            "meregdAccounts": [],
            "transactionsMade": []
          }
          userservice.addNewUswer(requestObject, function(response) {
            console.log(response);
            if (response == "User already registered") {
              $('.errordiv').html('').append('<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' + response);
            } else {
              localStorage.phoneNumber = phoneNumber;
              $('.errordiv').html('');
            }
          })
        }

        function errorHandler(e) {
          console.log("errorHandler: " + e);
        }

        function gotContacts(c) {
          console.log("gotContacts, number of results " + c.length);
          for (var i = 0, len = c.length; i < len; i++) {
            console.log(c[i]);
          }
        }

        $scope.scanShopQrCode = function() {
          console.log("Change");
          storeservice.getStoreDetails('1111', function(response) {
            console.log("Store Response");
            if (response != null) {
              $('.overlaycontent').addClass('animated fadeOutLeft');
              setTimeout(function() {
                $('.overlaycontent').css('display', 'none');
              }, 1000);
              localStorage.storeId = response.storeId;
              localStorage.storeName = response.storeName + " " + response.stroeAddress;
              $scope.storeFullAddress = response.storeName + " " + response.stroeAddress;
            } else {
              alert('Store is not registered');

            }
            //console.log(response);
          })

          // localStorage.phoneNumber = $scope.userphonenumber;
          // userservice.getUserInfo('9940366400', function(responsedata) {
          //   console.log(responsedata);
          // });
          //$('.overlaycontent').addClass('animated fadeOutLeft');
          // cordova.plugins.barcodeScanner.scan(function(result) {
          //   if (!result.cancelled) {
          //     var value = result.text;
          //     console.log("SCANNED CODE " + value);
          //
          //     //console.log("THE VALUE IS : " + value);
          //   }
          // }, function(error) {
          //   alert("Scanning failed: " + error);
          // });
        }
        $scope.isPhoneNumberPresent = function() {
          if (!angular.isUndefined(localStorage.phoneNumber) && localStorage.phoneNumber != null) {
            return true;
          } else {
            return false;
          }
        }
        $scope.getStoreId = function() {
          if ($scope.userphonenumber != null || $scope.userphonenumber.length > 0) {} else {}
        }
      });

      expressPayModule.controller("scanController", function($scope, inventoryService, userservice, $timeout) {

        //Nav Active fix
        $('.scanlink').children(".col-xs-3").addClass("customactive");
        $('.cartLink').children(".col-xs-3").removeClass("customactive");
        $('.offerLink').children(".col-xs-3").removeClass("customactive");
        $('.discoverlink').children(".col-xs-3").removeClass("customactive");

        $('.paybutton').css("display", "none");
        var totalCartItems = 0;
        $scope.scaneBarCode = function() {

          // navigator.contacts.find([navigator.contacts.fieldType.displayName], function(c) {
          //   console.log("gotContacts, number of results " + c.length);
          //   for (var i = 0, len = c.length; i < len; i++) {
          //     if(c[i].displayName!=null && c[i].phoneNumbers!=null){
          //       var phoneNumberVal=String(c[i].phoneNumbers[0].value);
          //       if(phoneNumberVal.length > 10 && phoneNumberVal){
          //
          //       }
          //       console.log(c[i].displayName+" : "+c[i].phoneNumbers[0].value);
          //     }
          //     //console.log(c[i]);
          //   }
          // }, function(e) {
          //   console.log("errorHandler: " + e);
          // });
          // var contactsList = [
          //   {
          //     "displayName": "Ramesh Malla",
          //     "phoneNumber": "9940366400"
          //   }, {
          //     "displayName": "Malla",
          //     "phoneNumber": "9940366401"
          //   }, {
          //     "displayName": "Doe",
          //     "phoneNumber": "9940366402"
          //   }
          // ];
          // userservice.setUserContacts(contactsList);

          console.log("Pressed");
          // $timeout(function() {
          //   angular.element('#triggers').trigger('click');
          // }, 100);
          //var array = ['123', '223'];

          inventoryService.setShoppingList("1111", "2222", function(responseBody) {
            //console.log("Item added in cart " + responseBody);

            $('.cartnum').text(inventoryService.getTotalCartItems());

          });
          inventoryService.setShoppingList("1111", "2223", function(responseBody) {
            //console.log("Item added in cart " + responseBody);
            // $timeout(function() {
            //     angular.element('#triggers').trigger('click');
            // }, 700);
            $('.cartnum').text(inventoryService.getTotalCartItems());
          });
          inventoryService.setShoppingList("1111", "2224", function(responseBody) {
            //console.log("Item added in cart " + responseBody);
            // $timeout(function() {
            //     angular.element('#triggers').trigger('click');
            // }, 700);
            $('.cartnum').text(inventoryService.getTotalCartItems());
          });

          // cordova.plugins.barcodeScanner.scan(function(result) {
          //     if (!result.cancelled) {
          //         var value = result.text;
          //         console.log("SCANNED CODE " + value);
          //         inventoryService.setShoppingList(value, function(responseBody) {
          //             console.log("Item added in cart");
          //             $timeout(function() {
          //                 angular.element('#triggers').trigger('click');
          //             }, 100);
          //         });
          //         //console.log("THE VALUE IS : " + value);
          //     }
          // }, function(error) {
          //     alert("Scanning failed: " + error);
          // });
        }
      });

      expressPayModule.controller("cartController", function($scope, inventoryService, reviewservice, transactionService, userservice) {

        $('.scanlink').children(".col-xs-3").removeClass("customactive");
        $('.cartLink').children(".col-xs-3").addClass("customactive");
        $('.offerLink').children(".col-xs-3").removeClass("customactive");
        $('.discoverlink').children(".col-xs-3").removeClass("customactive");

        $scope.userMainInfos = userservice.getUserDetails();

        var paymenuHeight = $('.paymenu').height();
        $('.paymentmethods').height(paymenuHeight);

        $('.paymentcontainer').css('display', 'none');
        //$('.cartsubmodel').css('display', 'none');
        $('.paynow').click(function() {
          $(".menudiv a").each(function(index) {
            if ($(this).children(".col-xs-3").hasClass("customactive")) {
              $(this).children(".col-xs-3").removeClass("customactive")
              return false;
            }
          });
          $('.cartsubmodel').css('display', 'none');
          $('.paymentcontainer').css('display', 'inline');
        });
        $('.paycancle').click(function() {
          $('.paymentcontainer').css('display', 'none');
          $('.cartsubmodel').css('display', 'inline');
        })
        $('.cartLink').click(function() {
          $('.paymentcontainer').css('display', 'none');
          if ($scope.shoppingList.length == 0) {
            $('.cartsubmodel').css('display', 'none');
            $('.paymentsuccesscontainer').css('display', 'none');
            $('.yourcartisempty').css('display', 'inline');
          } else {
            $('.cartsubmodel').css('display', 'inline');
          }
        })

        $scope.resetImageBackdrop = function(bankselected) {
          $('.bankcol').closest('.activeBank').removeClass("activeBank");
          $('.paybankbtn').prop('disabled', false);
          $scope.selectedBank = bankselected;
        }

        $('.paybtn').prop('disabled', true);
        $('.paybankbtn').prop('disabled', true);
        $('.bankcol').click(function() {
          $('.bankcol').closest('.activeBank').removeClass("activeBank");
          $(this).addClass('activeBank');
          var val = $(this).find('img').attr('alt');
          $scope.$apply(function() {
            $('.paybankbtn').prop('disabled', false);
            $scope.selectedBank = val;
            console.log("IMG " + $scope.selectedBank);
          })

        })
        $('.cardGroup').click(function() {
          $('.paymentmethodbank').css('display', 'none')
          $('.paymentmethodcash').css('display', 'none');
          $('.paymentmethodshopcard').css('display', 'none');
          $('.paymentmethodcard').css('display', 'inline-block')
        });
        $('.bankGroup').click(function() {
          $('.paymentmethodcard').css('display', 'none');
          $('.paymentmethodcash').css('display', 'none');
          $('.paymentmethodshopcard').css('display', 'none');
          $('.paymentmethodbank').css('display', 'inline-block')

        });
        $('.cashGroup').click(function() {
          $('.paymentmethodbank').css('display', 'none')
          $('.paymentmethodcard').css('display', 'none');
          $('.paymentmethodshopcard').css('display', 'none');
          $('.paymentmethodcash').css('display', 'inline-block')
        });
        $('.shopCardGroup').click(function() {
          $('.paymentmethodbank').css('display', 'none')
          $('.paymentmethodcard').css('display', 'none');
          $('.paymentmethodcash').css('display', 'none')
          $('.paymentmethodshopcard').css('display', 'block')
        });

        // $('.cardnumber').keypress(function(event) {
        //   var keycode = event.which;
        //   //console.log(event.currentTarget.className);
        //   if (!(event.shiftKey == false && (keycode == 46 || keycode == 8 || keycode == 37 || keycode == 39 || (keycode >= 48 && keycode <= 57)))) {
        //     event.preventDefault();
        //   }
        // });

        $(".payment-group-item").click(function() {
          $(".payment-group-item").each(function(index) {
            if ($(this).hasClass("activepaymentgroup")) {
              $(this).removeClass("activepaymentgroup")
              return false;
            }
          });
          $(this).addClass('activepaymentgroup');
        });
        var scrollHeight = parseFloat($('.paymentfooter').offset().top) - parseFloat($('.toolheader').offset().top) - parseFloat(35);
        $('.itemListrow').height(scrollHeight);

        $('.paybutton').css("display", "inline-block");
        /*Review details*/
        $scope.getReviewDetails = function(itemId) {
          var contacts = userservice.getUserContacts();
          $scope.reviewContactList = [];
          $('#reviewModel').modal('show');
          for (var i = 0; i < contacts.length; i++) {
            var conObj=contacts[i];
            userservice.getOtherUserInfo(contacts[i].phoneNumber, function(userresponse) {
              console.log(userresponse);
              if (userresponse != null && userresponse.isSharable) {
                reviewservice.getReviewsOfUsers(itemId, conObj, function(response) {
                  $scope.reviewContactList.push(response);
                  console.log($scope.reviewContactList);
                });
              }
            })
          }

        }
        /*Get Shopping List*/
        $scope.shoppingList = inventoryService.getShoppinList();
        /*Get Total Items in cart*/
        $scope.totalItems = inventoryService.getTotalCartItems();
        if ($scope.totalItems == 0) {
          $('.paymentcontainer').css('display', 'none');
          $('.cartsubmodel').css('display', 'none');
          $('.paymentsuccesscontainer').css('display', 'none');
          $('.yourcartisempty').css('display', 'inline');
        }
        /*Get Total Price*/
        $scope.totalPrice = inventoryService.getTotalPrice();

        $scope.getImage = function(imageUrl) {
          //console.log(imageUrl);
          return imageUrl + ".jpg";
        }

        $scope.setItemToDelete = function(itemId) {
          $scope.iteIdToDelete = itemId;
        }

        $scope.editItems = function(itemId, itemName, totalQuantity, totalPrice, itemPrice) {
          console.log(itemId + " " + itemName + " " + totalQuantity + " " + totalPrice);
          $scope.edititemId = itemId;
          $scope.edititemName = itemName;
          $scope.edittotalPrice = totalPrice;
          $scope.qtychange = totalQuantity;
          $scope.cloneQuantity = totalQuantity;
          $scope.editItemPrice = itemPrice;
        }

        var updateFuntion = function(itemId, changedQuantity, totalPrice) {
          angular.forEach($scope.shoppingList, function(value, key) {
            if (value.itemId == itemId) {
              var difference = 0;
              if (value.totalQuantity > changedQuantity) {
                difference = Number(value.totalQuantity) - Number(changedQuantity);
                $scope.totalItems = inventoryService.updateTotalCartItems(difference, true);
              } else {
                difference = Number(changedQuantity) - Number(value.totalQuantity);
                $scope.totalItems = inventoryService.updateTotalCartItems(difference, false);
              }
              value.totalQuantity = changedQuantity;
              $scope.totalPrice = inventoryService.updateTotalPrice(totalPrice, false);;
              return false;
            }
          });
        }

        $scope.quantityIncrease = function(itemId, initQuant, itemPrice, discountPrice, actulaQuantity, totalPrice) {
          var changedQuantity = Number(initQuant) + 1;
          if (actulaQuantity >= changedQuantity) {
            if (discountPrice != null) {
              itemPrice = discountPrice;
            }
            var totalPrice = Number(totalPrice) + Number(itemPrice);
            updateFuntion(itemId, changedQuantity, totalPrice);
          }

        }
        $scope.quantityDecrease = function(itemId, initQuant, itemPrice, discountPrice, actulaQuantity, totalPrice) {
          if (initQuant > 1) {
            var changedQuantity = Number(initQuant) - 1;
            if (discountPrice != null) {
              itemPrice = discountPrice;
            }
            var totalPrice = Number(totalPrice) - Number(itemPrice);
            updateFuntion(itemId, changedQuantity, totalPrice);
          }

        }

        $scope.changeFunction = function(intialQuantity, itemPrice, totalPrice, changedQuantity) {
          var totalScopePrice = $scope.totalPrice;
          console.log(intialQuantity + " " + itemPrice + " " + totalPrice + " " + changedQuantity);
          if (intialQuantity == changedQuantity) {
            $scope.edittotalPrice = totalScopePrice;
          } else if (intialQuantity > changedQuantity) {
            $scope.cloneQuantity = changedQuantity;
            $scope.edittotalPrice -= Number(itemPrice);
          } else if (intialQuantity < changedQuantity) {
            $scope.cloneQuantity = changedQuantity;
            $scope.edittotalPrice += Number(itemPrice);
          }
        }

        $scope.editFunction = function(itemId, changedQuantity, totalPrice) {
          angular.forEach($scope.shoppingList, function(value, key) {
            if (value.itemId == itemId) {
              var difference = 0;
              if (value.totalQuantity > changedQuantity) {
                difference = Number(value.totalQuantity) - Number(changedQuantity);
                $scope.totalItems = inventoryService.updateTotalCartItems(difference, true);
              } else {
                difference = Number(changedQuantity) - Number(value.totalQuantity);
                $scope.totalItems = inventoryService.updateTotalCartItems(difference, false);
              }
              value.totalQuantity = changedQuantity;
              $scope.totalPrice = inventoryService.updateTotalPrice(totalPrice, false);;
              return false;
            }
          });
        }

        $scope.payAndGetTransactionDetails = function(shoppingList, amountPayed, modeOfPayment, bankName) {
          console.log($scope.selectedBank);
          var requestData = {
            "storeId": localStorage.storeId,
            "userId": localStorage.phoneNumber,
            "amountPayed": amountPayed,
            "modeOfPayment": modeOfPayment,
            "offerId": localStorage.offerId,
            "bankName": bankName,
            "itemsPurchased": shoppingList
          };

          console.log(JSON.stringify(requestData));

          $scope.transactionData = transactionService.enterTransactionDetail(requestData, function(responseBody) {
            console.log(JSON.stringify(responseBody));

            $('.paymentcontainer').css('display', 'none');
            $('.cartsubmodel').css('display', 'none');
            $('.paymentsuccesscontainer').css('display', 'inline');
            inventoryService.resetAll();
            $scope.shoppingList = [];
            $scope.totalItems = 0;
            $scope.totalPrice = 0;
            console.log(responseBody._id);
            $scope.transactionId = responseBody._id;
          });
          // console.log(shoppingList + " " + amountPayed + " " + modeOfPayment);
        }

        $scope.resetCardValues = function() {
          $scope.cardnumber = null;
          $scope.expirydate = null;
          $scope.cvvnumber = null;
          //$('.paybtn').prop('disabled', true);
        }

        $scope.validateFields = function() {
          var isCardNumberValid,
            isDateValid,
            isCvvNumberValid = false;
          console.log("IN");
          if ($scope.cardnumber != null && $scope.cardnumber.toString().length == 16) {
            console.log("Card");
            isCardNumberValid = true;
          }
          if ($scope.expirydate != null) {
            console.log("Date");
            isDateValid = true;
          }
          if ($scope.cvvnumber != null && $scope.cvvnumber.length == 3) {
            console.log("CVV");
            isCvvNumberValid = true;
          }
          if (isCardNumberValid && isDateValid && isCvvNumberValid) {
            console.log("All are valid");
            $('.paybtn').prop('disabled', false);
          } else {
            $('.paybtn').prop('disabled', true);
          }
        }

        $scope.removeItem = function(itemId, flag) {
          console.log(itemId + " " + flag);
          if (flag) {
            if ($scope.shoppingList.length > 0) {
              angular.forEach($scope.shoppingList, function(value, key) {
                console.log(key);
                if (value.itemId == itemId) {
                  $scope.shoppingList.splice(key, 1);
                  $scope.totalItems = inventoryService.updateTotalCartItems(value.totalQuantity, true);
                  if ($scope.totalItems == 0) {
                    $('.paymentcontainer').css('display', 'none');
                    $('.cartsubmodel').css('display', 'none');
                    $('.paymentsuccesscontainer').css('display', 'none');
                    $('.yourcartisempty').css('display', 'inline');
                  }
                  console.log(value.totalPrice);
                  $scope.totalPrice = inventoryService.updateTotalPrice(value.totalPrice * value.totalQuantity, true);
                  return false;
                }
              });
            }
          }
        }
        $scope.$watch("totalItems", function() {
          var cartItem = $scope.totalItems;
          $('.cartnum').text(cartItem);
        });
      });

      expressPayModule.controller("offerController", function($scope, $timeout, offerservice, inventoryService, newArrivalService, transactionService, userservice) {

        $('.scanlink').children(".col-xs-3").removeClass("customactive");
        $('.cartLink').children(".col-xs-3").removeClass("customactive");
        $('.offerLink').children(".col-xs-3").addClass("customactive");
        $('.discoverlink').children(".col-xs-3").removeClass("customactive");

        var phoneNumbersToShare = [];
        $scope.isMyoffer = false;
        console.log($('.contactsheader').outerHeight());
        // $('.contacatscolumn').css('top', $('.contactsheader').outerHeight() + 'px');
        $scope.shareOfferInfo = function() {
          if (phoneNumbersToShare.length > 0) {
            var requestBody = {
              "numbers": phoneNumbersToShare,
              "message": $scope.shareMessgae,
              "itemId": $scope.sharedItem
            }
            console.log("Gonna Share");
            console.log(requestBody);
            userservice.shareofferinfo(localStorage.phoneNumber, requestBody, function(sharedmessage) {
              console.log(sharedmessage);
            })
          }
        }

        $scope.transferOffer = function() {
          console.log("Called");
        }

        $scope.setToShare = function(phoneNumber) {
          var indexofPhoneNUmber = phoneNumbersToShare.indexOf(phoneNumber);
          if (indexofPhoneNUmber < 0) {
            phoneNumbersToShare.push(phoneNumber);
          } else {
            phoneNumbersToShare.splice(indexofPhoneNUmber, 1);
          }
          if (phoneNumbersToShare.length > 0) {
            $('.sharespan').html('').append('<i class="fa fa-share-alt" aria-hidden="true"></i>');
          } else {
            $scope.allselect = false;
            $('.sharespan').html('')
          }
          //Call local notification
          console.log(phoneNumbersToShare);
        }

        $scope.activateAll = function() {
          // console.log($scope.allselect);
          if ($scope.allselect) {
            $('.contactsgroup').each(function(index) {
              var checkbtn = $(this).children('.myfillin');
              var thisClass = $(this).children(".customchecklabel");
              setTimeout(function() {
                // console.log(thisClass);
                if (!checkbtn.prop('checked')) {
                  thisClass.trigger('click');
                }

              }, 300);

            })
          } else {
            $('.contactsgroup').each(function(index) {
              // console.log("INDEX :" + index);
              var checkbtn = $(this).children('.myfillin');
              var thisClass = $(this).children(".customchecklabel");
              setTimeout(function() {
                if (checkbtn.prop('checked')) {
                  thisClass.trigger('click');
                }
              }, 300);
            })
          }

        }

        $scope.shareOffer = function(itemid, item, discount) {
          //console.log("Action");
          $('.shareoverlay').css('display', 'block');
          $scope.sharedItem = itemid;
          // $scope.sharedDiscount = item;
          // $scope.shareItemId = discount;
          $scope.shareMessgae = discount + " on " + item;

          console.log($scope.shareMessgae);
          console.log($scope.sharedItem);
          setTimeout(function() {
            $('.shareoverlay').animate({
              right: '0%'
            }, "fast", "linear");
          }, 200);

        }

        $('.shareback').click(function() {
          $('.shareoverlay').animate({
            right: '100%'
          }, "fast", "linear");
          setTimeout(function() {
            $('.shareoverlay').css('display', 'none');
          }, 200);

        })

        $scope.userContacts = userservice.getUserContacts();
        console.log($scope.userContacts);
        //var brandHeight = Number($('body').outerHeight(true)) - Number($('.branddiv').outerHeight(true))+1;
        var headerHeight = $('.menuheader').outerHeight(true) - 1;
        var offerToolsHeight = $('.offertools').outerHeight(true) + 10;
        $scope.filterBycategoryElements = [];
        $('.offertools').css('top', headerHeight + 'px');
        $('.offer-list-group').css('margin-top', offerToolsHeight + 'px');

        //$('.shareoverlay').height(brandHeight);

        var overFlowHeight = parseFloat($('.offernewfooter').offset().top) - parseFloat($('.offerviewcontainer').offset().top);
        $('.offerviewcontainer').height(overFlowHeight);
        $('.offercarousel').slick({arrows: false, mobileFirst: true, autoplay: true});

        $('.offerbtn').click(function() {
          $scope.isMyoffer = false;
          $('.trnsferdiv').css('display', 'none');
          $('.myofferbtn').removeClass("offersactive");
          $('.arrivalbtn').removeClass("offersactive");
          $(this).addClass("offersactive");
          getOffersDetails();
        });
        $('.arrivalbtn').click(function() {
          $scope.isMyoffer = false;
          $('.trnsferdiv').css('display', 'none');
          $('.offerbtn').removeClass("offersactive");
          $('.myofferbtn').removeClass("offersactive");
          $(this).addClass("offersactive")
        });
        $('.myofferbtn').click(function() {
          $scope.isMyoffer = true;
          $('.trnsferdiv').css('display', 'none');
          $('.offerbtn').removeClass("offersactive");
          $('.arrivalbtn').removeClass("offersactive");
          $(this).addClass("offersactive")
          getOffersByOfferId(localStorage.storeId, "OFR12347");
        });

        $scope.showTrans = function(id) {
          $scope.transItemId = id;
          $scope.transOfferId = "OFR12347";
        }

        $scope.proceedTransfer = function(toPhoneNumber) {
          userservice.getOtherUserInfo(toPhoneNumber, function(response) {
            var offerId = response.offerId;
            offerservice.transferOfferId(localStorage.storeId, $scope.transItemId, $scope.transOfferId, offerId, function(response) {
              getOffersByOfferId(localStorage.storeId, "OFR12347");
            })
          })
        }

        $scope.message = "View Offers"
        var getOffersDetails = (function offdetails() {
          $scope.offerAvailedProducts = [];
          offerservice.getOffersByStoreId(localStorage.storeId, function(response) {
            angular.forEach(response, function(value, key) {
              inventoryService.getInventoryDetails(value.storeId, value.itemId, function(response) {
                response.discountAvailed = value.discountRate + "% off"
                $scope.offerAvailedProducts.push(response);
              })
            })
          });
          return offdetails;
        })();

        var getOffersByOfferId = function(storeId, offerId) {
          $scope.offerAvailedProducts = [];
          offerservice.getOffersByOfferId(storeId, offerId, function(response) {
            angular.forEach(response, function(value, key) {
              inventoryService.getInventoryDetails(value.storeId, value.itemId, function(response) {
                response.discountAvailed = value.discountRate + "% off"
                $scope.offerAvailedProducts.push(response);
              })
            })
          });
        }

        $scope.getProductImage = function(imageUrl) {
          return imageUrl + ".jpg";
        }

        $scope.changeIncategory = function(category, flag) {
          //test();
          console.log(category + " " + flag);
          if (category != null && flag) {
            if ($.inArray(category, $scope.filterBycategoryElements) == -1) {
              $scope.filterBycategoryElements.push(category);
            }
          } else if (category != null && !flag) {
            var i = $.inArray(category, $scope.filterBycategoryElements);
            if (i > -1) {
              $scope.filterBycategoryElements.splice(i, 1);
            }
          }
        }
        $scope.imageClick = function() {
          $(".combinedoffer").toggle("slide", 100);
          $('.viewallofferTab').toggle("slide", 100);
          $('.footertabs').css('display', 'inline');
          $('.offerGroup').css('display', 'inline');
        }
        $scope.getNewArrivals = function() {
          console.log("New Arrivals");
          $scope.offerAvailedProducts = [];
          newArrivalService.getNewArrivals(localStorage.storeId, function(newArrivals) {
            angular.forEach(newArrivals, function(value, key) {
              inventoryService.getInventoryDetails(value.storeId, value.itemId, function(response) {
                //response.discountAvailed = value.discountRate + "% off"
                $scope.offerAvailedProducts.push(response);
              })
            })
          })
        }

        $scope.testfilter = function(product) {
          //  console.log(JSON.stringify(product));
          if ($scope.filterBycategoryElements.length != 0 && ($.inArray(product.itemCategory, $scope.filterBycategoryElements) == -1)) {
            return;
          }
          return product;
        }

      });

      expressPayModule.controller('discoverController', function($scope, transactionService, userservice, reviewservice) {

        $('.scanlink').children(".col-xs-3").removeClass("customactive");
        $('.cartLink').children(".col-xs-3").removeClass("customactive");
        $('.offerLink').children(".col-xs-3").removeClass("customactive");
        $('.discoverlink').children(".col-xs-3").addClass("customactive");

        $scope.userMainInfo = userservice.getUserDetails();

        //console.log($scope.userMainInfo.quickPay);

        $scope.updateReview = function(itemId, itemrating, itemCommnet) {
          var requestData = {
            "phoneNumber": localStorage.phoneNumber,
            "userRating": String(itemrating),
            "userComment": itemCommnet
          }
          if (!$scope.isPushRequired) {
            reviewservice.updatereviews(itemId, localStorage.phoneNumber, requestData, function(responsedata) {
              console.log("Review Updated");
            })
          } else {
            reviewservice.addNewReview(itemId, requestData, function(responsedata) {
              console.log("Review Added");
              console.log(responsedata);
            })

          }
        }

        $scope.showReview = function(itemId, itemName) {
          $scope.reviewItemName = itemName;
          reviewservice.getReview(itemId, localStorage.phoneNumber, function(data) {
            if (data != null) {
              var reviewModelData = data.userReviews[0];
              $scope.reviewRating = Number(reviewModelData.userRating);
              $scope.reviewUserComment = reviewModelData.userComment;
              $scope.reviewItemId = itemId;
              $scope.isPushRequired = false;
              $('.reviewmodel').modal('show');
            } else {
              $scope.isPushRequired = true;
              // $scope.reviewModelData = null;
              $scope.reviewRating = null;
              $scope.reviewUserComment = null;
              $scope.reviewItemId = itemId;
              $('.reviewmodel').modal('show');
            }
          })
        }

        $scope.ob = {
          "quickPay": {
            "card": [
              {
                "cardName": "Card One",
                "cardNumber": "123456789"
              }, {
                "cardName": "Card Two",
                "cardNumber": "223256789"
              }
            ],
            "netBanking": [
              {
                "bankName": "Kotak Bank"
              }
            ]
          }
        };

        $scope.setValueForCardUpdate = function(indexVal) {

          if (indexVal == null) {
            $('.qpaydisplay').css('display', 'none');
            $('.qpaybankpanel').css('display', 'none');
            $('.qpaycardpanel').css('display', 'block');

            console.log("ADD CARD");
          } else {
            $scope.userMainInfo.quickPay.card.splice(indexVal, 1);
            userservice.updateUserQpayDetails(localStorage.phoneNumber, $scope.userMainInfo.quickPay, function(updatedUserdata) {
              $scope.userMainInfo = updatedUserdata;
            });
            //var qpayObject = $scope.userMainInfo.quickPay.card[indexVal];
            //console.log(qpayObject.cardNumber+" "+qpayObject.cardName);
            //$scope.mycardnumber = Number(qpayObject.cardNumber);
            //$scope.mycardname = qpayObject.cardName;
            //$scope.mycardexpiry = qpayObject.cardExpiry;
          }
        }

        $scope.setValueForBankUpdate = function(indexVal) {
          if (indexVal == null) {
            $('.qpaydisplay').css('display', 'none');
            $('.qpaycardpanel').css('display', 'none');
            $('.qpaybankpanel').css('display', 'block');
            console.log("ADD BANK");
          } else {
            $scope.userMainInfo.quickPay.netBanking.splice(indexVal, 1);
            userservice.updateUserQpayDetails(localStorage.phoneNumber, $scope.userMainInfo.quickPay, function(updatedUserdata) {
              $scope.userMainInfo = updatedUserdata;
            });
          }
        }

        $scope.updateQpayCard = function() {
          var qpayObject = $scope.userMainInfo.quickPay;
          var modifiedObject = {
            "cardNumber": String($scope.mycardnumber),
            "cardName": $scope.mycardname,
            "cardExpiry": $scope.mycardexpiry
          }
          qpayObject.card.push(modifiedObject);
          userservice.updateUserQpayDetails(localStorage.phoneNumber, qpayObject, function(updatedUserdata) {
            $scope.userMainInfo = updatedUserdata;
            $scope.resetAllDiv();
          });
        }

        $scope.updateQpayBank = function(index) {
          var qpayObject = $scope.userMainInfo.quickPay;
          var modifiedObject = {
            "bankName": $scope.selectedBank
          }
          qpayObject.netBanking.push(modifiedObject);
          userservice.updateUserQpayDetails(localStorage.phoneNumber, qpayObject, function(updatedUserdata) {
            $scope.userMainInfo = updatedUserdata;
            $scope.resetAllDiv();
          });
        }

        var headerHeight = $('.menuheader').outerHeight(true) - 1;

        $('.discovermainheading').css('top', headerHeight + 'px');

        $('.sidedrag').click(function() {
          $('.discoversidemenu').toggleClass("move");
          $('.backdrop').toggleClass("backdropover");
        })
        $('.backdrop').click(function() {
          $('.discoversidemenu').toggleClass("move");
          $('.backdrop').toggleClass("backdropover");
        })
        $('.sidebtnlist').click(function() {
          $(".sidebtnlist").each(function(index) {
            if ($(this).hasClass("customactiveside")) {
              $(this).removeClass("customactiveside")
              return false;
            }
          });
          $(this).addClass("customactiveside");
          //$(this).css({"background-color":"#363538","color":"white"});
        });

        $scope.toggleDiscDiv = function(divname, spanname) {
          $('.subcontents').each(function(index) {
            $(this).css('display', 'none');
          })
          $('.discmodheader').html('').prepend(spanname);
          $('.' + divname).css('display', 'block');

          $('.qpaycardpanel').css('display', 'none');
          $('.qpaybankpanel').css('display', 'none');
          $('.qpaydisplay').css('display', 'block');

        }

        transactionService.getTransactionDetails(localStorage.phoneNumber, function(responseData) {
          $scope.transactionDetails = responseData;
          //console.log($scope.transactionDetails);
        });
        $scope.convertDate = function(dateval) {
          var monthArray = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec"
          ];
          $scope.transmonth = monthArray[new Date(dateval).getMonth()];
          $scope.transyear = new Date(dateval).getFullYear()
          return new Date(dateval).getDate();
        }
        $('.qpaycardedit').click(function() {
          $('.qpaydisplay').css('display', 'none');
          $('.qpaybankpanel').css('display', 'none');
          $('.qpaycardpanel').css('display', 'block');

        });

        $('.qpaybankedit').click(function() {

          $('.qpaydisplay').css('display', 'none');
          $('.qpaycardpanel').css('display', 'none');
          $('.qpaybankpanel').css('display', 'block');

        });

        $scope.resetAllDiv = function() {
          $scope.mycardnumber = null;
          $scope.mycardname = null;
          $scope.mycardexpiry = null;
          $scope.selectedBank = null;
          $('.qpaycardpanel').css('display', 'none');
          $('.qpaybankpanel').css('display', 'none');
          $('.qpaydisplay').css('display', 'block');
        }

        $scope.enableFocus = function() {
          var dateOb = new Date();
          var fullYear = dateOb.getFullYear();
          //console.log(fullYear);
          $scope.yearDropValues = [];
          for (var i = 0; i < 100; i++) {
            $scope.yearDropValues.push(fullYear + i);
          }
          //console.log($scope.yearDropValues);
          $('.datemodel').modal('show');
        }

        $scope.resetImageBackdrop = function(bankselected) {
          $('.bankcol').closest('.activeBank').removeClass("activeBank");
          $('.paybankbtn').prop('disabled', false);
          $scope.selectedBank = bankselected;
        }

        $scope.formExpiry = function() {
          if (!angular.isUndefined($scope.selectedmonth) && !angular.isUndefined($scope.selectedyear)) {
            $scope.mycardexpiry = $scope.selectedmonth + "  /  " + $scope.selectedyear;
          }
        }

        $('.bankcol').click(function() {
          $('.bankcol').closest('.activeBank').removeClass("activeBank");
          $(this).addClass('activeBank');
          var val = $(this).find('img').attr('alt');
          $scope.$apply(function() {
            $scope.selectedBank = val;
          });

        })

      });
    </script>
    <script type="text/javascript" src="service/userService.js"></script>
    <script type="text/javascript" src="service/newArrivalsService.js"></script>
    <script type="text/javascript" src="service/offerservice.js"></script>
    <script type="text/javascript" src="service/inventoryservice.js"></script>
    <script type="text/javascript" src="service/transactionservice.js"></script>
    <script type="text/javascript" src="service/reviewservice.js"></script>
    <script type="text/javascript" src="service/storeservice.js"></script>
  </body>

</html>
